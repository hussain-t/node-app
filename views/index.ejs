<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MY APP</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.dataTables.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.1.1/js/dataTables.responsive.min.js"></script>
  <!--<script src="main.js"></script>-->
</head>
<body>
  May Node and Express be with you.

  <!--<table id="quote" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Name</th>
                <th>Quote</th>                
            </tr>
        </thead>
        <tbody>
          <% for(var i=0; i<quotes.length; i++) {%>
            <tr class="quote">
                <td><%= quotes[i].name %></td>
                <td><%= quotes[i].quote %></td>                
            </tr>
         <% } %>
      </tbody>
  </table>-->

<div id='app'></div>
  
  <form action="/quotes" method="POST">
    <input type="text" id="name" placeholder="name" name="name">
    <input type="text" id="quote1" placeholder="quote" name="quote">
    <button type="button" onClick="saveAndGetQuote()">Save</button>
  </form>
</body>

<script>
  $(document).ready(function() {
      //$('#quote').DataTable();     
      getQuoteForDatatable();
  });

  var edit = '<button id="btnEdit">Edit</button>';
  var deleteBtn = '<button id="btnDelete">Delete</button>';

  function getQuoteForDatatable(afterDelete) {
      $.ajax({
          type: 'POST',
          //data: "",
          url: 'http://localhost:3001/getQuoteForDatatable',
          success: function(response) {
              console.log('response ' + JSON.stringify(response));
              var dTable = '<table id="tblQuotes" class="display responsive nowrap" cellspacing="0" width="100%">';
                  dTable += '<thead><tr><th>Name</th><th>Quote</th><th>Actions</th></tr></thead><tbody>';
                              
              $.each(response, function(index, element){
                  dTable += '<tr><td>' + element.name + '</td><td>' + element.quote + '</td>' + 
                            '<td><button id="btnEdit_' + element._id + '">Edit</button>&nbsp;' +
                            '<button id="btnDelete_' + element._id + '" onClick=deleteQuote("' + element._id + '")>Delete</button></td></tr>';
              });
              dTable += '</tbody></table>';
              
              if (afterDelete) {
                  $('#app').html(dTable);
              } else {
                  $('#app').append(dTable);
              }
              
              $('#tblQuotes').DataTable();
          },
          error: function(err){
              console.log('err ' + err);
          }
      });
      //console.log(data);
  }

  function saveAndGetQuote() {
    var data = {
        name: $('#name').val(),
        quote: $('#quote1').val()
    };

    console.log(JSON.stringify(data));
        $.ajax({
            type: 'POST',
            data: data,
            //dataType: 'json',
            //contentType: 'application/json',
            url: 'http://localhost:3001/saveAndGetQuote',
            success: function(response) {
                console.log('response ' + JSON.stringify(response));
                var dTable = '<table id="tblQuotes" class="display responsive nowrap" cellspacing="0" width="100%">';
                    dTable += '<thead><tr><th>Name</th><th>Quote</th><th>Actions</th></tr></thead><tbody>';
                                
                $.each(response, function(index, element){
                    dTable += '<tr><td>' + element.name + '</td><td>' + element.quote + '</td>' +
                                '<td><button id="btnEdit_' + element._id + '">Edit</button>&nbsp;' +
                                '<button id="btnDelete_' + element._id + '" onClick=deleteQuote("' + element._id + '")>Delete</button></td></tr>';        
                });
                dTable += '</tbody></table>';
                
                $('#app').html(dTable);
                $('#tblQuotes').DataTable();
                
                document.getElementById('name').value = "";
                document.getElementById('quote1').value = "";
            },
            error: function(err){
                console.log('err ' + err);
            }
      });
  }

  function deleteQuote(id) {
    $.ajax({
        type: 'Delete',
        url: 'deleteQuote',
        data: {'_id': id },        
        success: function(data) {
            getQuoteForDatatable(true);
        },
        error: function(err){
            console.log('err ' + err);
        }       
    });
  }
  

</script>

</html>